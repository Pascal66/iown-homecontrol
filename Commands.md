# io-homecontrol Commands

A command is built as follow:

| Command Id |   Data   |
| :--------: | :------: |
|   1 Byte   |  n Byte  |

- Command Id: Identifies the desired action
- Command Parameter / Data (Optional): Additional Parameter or Data

## Command Parameter Types

### ACEI

According to the io-homecontrol shared library, it is composed of one byte as following (bit positions in header):

|            7-5  |                4-3      |                    2-1      |   0 |
| :-------------: | :---------------------: | :-------------------------: | :-: |
|  Priority level | Priority Service Number | Extended information number |   1 |

- bit[3] Priority Level (see KLF 200 API on page 58/59)
  - Protection
    - 0[000] = Human Protection - Most secure level. Will disable all categories (Level 0 to 7).
      > Since consequences of misusing this level can deeply impact the system behaviour, and therefore the io-homecontrol image, it is mandatory for the manufacturer that wants to use this level of priority to receive an agreement from io-homecontrol®
    - 1[001] = Environment Protection - Local Sensors (goods protection): Endproduct or house goods protection.
  - User
    - 2[010] = Level 1 - Controllers having a higher level of priority than others.
    - 3[011] = Level 2 - Default for Controllers. Sends immediate action command(s).
  - Comfort
    - 4[100] = Level 1 - TBD
    - 5[101] = Level 1 - TBD
    - 6[110] = Level 3 - Used by Stand Alone Automatic Controls (SAAC)
    - 7[111] = Level 4 - TBD
- bit[2] Priority Service Number
- bit[2] ExtendedInfo
- bit[1] Undefined = Always 1

The LSB must be 1, it is not considered valid if this bit is set to 0.

### Command Originator

Specifies the command originator type (USER/TIMER/SECURITY etc.)

- 0x00 = Local User: User pressing button locally on actuator
- 0x01 = **User**: User Remote control causing action on actuator
- 0x02 = Rain Sensor
- 0x03 = Timer (Sensor)
- 0x04 = Security: SCD controlling actuator
- 0x05 = UPS: Uninterruptible Power Supply
- 0x06 = SFC: Smart Function Controller
- 0x07 = LSC: Lifestyle Scenario Controller
- 0x08 = **SAAC**: Stand Alone Automatic Controls
- 0x09 = Wind Sensor
- 0x0B = Automatic Cycle/External Access/Load Shedding (Managers for requiring a particular electric load shed)
- 0x0C = Local Light Sensor
- 0x0D = Unspecific Enviroment Sensor (Used with commands of unknown sensor for protection of end-product or house goods)
- 0x10 = Myself: Used when an actuator decides to move by itself (Generated by Actuator)
- 0xC8 = Unknown
- 0xFE = Automatic Cycle: Used in context with automatic cycle
- 0xFF = Emergency: Used in context with emergency or security commands, this command originator should never be disabled

**Note** Typically, only USER or SAAC are used.

### Main Parameter

- 0x0000 = Min / On
- 0xC800 = Max / Off
- 0xD100 (53504) = Target
- 0xD200 (53760) = Current
- 0xD300 (54016) = Default
- 0xD400 (54272) = Ignore
- 0xF7FF = Unknown Value

### Velocity

-   0 = Default
-   1 = Silent
-   2 = Fast
- 255 = Velocity Not Available: Only used in status reply

### Controller Copy Mode

- 0 = Transmitting Configuration Mode (TCM): Gateway gets key and system table from another controller.
- 1 = Receiving Configuration Mode (RCM): Gateway gives key and system table to another controller.

### Manufacturer Id

Manufacturers have their own ID:

- Public        : 00
- Velux         : 01
- Somfy         : 02
- Honeywell     : 03
- Hörmann       : 04
- ASSA ABLOY    : 05
- Niko          : 06
- Window Master : 07
- Renson        : 08
- CIAT          : 09
- Secuyou       : 0A
- OVERKIZ       : 0B
- Atlantic Group: 0C
- Zehnder Group : 0D

### Node Type, Sub Type and Variation

- byte[2] NodeType and NodeSubType (2 bytes): Type takes the MSB (10 bits) and Subtype the LSB (6 bits)
  - bit[10] NodeType    = (field >> 6) & 1023
  - bit[06] NodeTypeSubtype = field & 63
- byte[1] NodeVariation: Depends on the NodeType/SubType

#### Actuators

- 0 = No Type: All nodes except controller
- 1 = INTERIOR Venetian blind
- 2 = Roller shutter
- 3 = Awning: Vertical Exterior for Windows
- 4 = Window Opener
- 5 = Garage Door Opener
- 6 = Light
- 7 = Gate opener
- 8 = Rolling Door Opener
- 9 = Door Lock
- 10 = Interior Vertical Blind
- 11 = SCD: Secure Configuration Device
- 12 = Beacon
- 13 = Dual Rolling Shutter
- 14 = Temperature Control Interface (Heating)
- 15 = Switch: On / Off
- 16 = Horizontal Awning
- 17 = External Venetian Blind
- 18 = Louvre Blind
- 19 = Curtain track
- 20 = Ventilation Point
- 21 = Exterior Heating
- 22 = Heat pump: Not currently supported?
- 23 = Intrusion Alarm System
- 24 = Swinging Shutter
- 27 = SLIDING_WINDOW
- 28 = ZONE_CONTROL_GENERATOR
- 29 = BIOCLIMATIC_PERGOLA
- 30 = INDOOR_SIREN
- 51 = DOMESTIC_HOT_WATER
- 52 = ELECTRICAL_HEATER
- 53 = HEAT_RECOVERY_VENTILATION
- 255 = CENTRAL_HOUSE_CONTROL
- 1023 = REMOTE_CONTROLLER

#### Variations

- 0 = Not Set
- 1 = Top Hung Window
- 2 = Kip Window
- 3 = Flat Roof Window
- 4 = Sky Light Window

#### Sensors

- 0 = UNKNOWN_SENSOR_0
- 1 = UNKNOWN_SENSOR_1
- 2 = TEMPERATURE_INSIDE_SENSOR
- 3 = TEMPERATURE_OUTSIDE_SENSOR
- 5 = PRESSURE_SENSOR
- 11 = LIGHT_OUTSIDE_SENSOR
- 12 = CUMULATED_GAS
- 13 = WATER_CONSUMPTION_SENSOR
- 14 = THERMAL_CONSUMPTION_SENSOR
- 15 = ELECTRIC_CONSUMPTION_SENSOR
- 128 = SMOKE_SENSOR
- 133 = OPENING_DETECTOR
- 134 = MOTION_SENSOR
- 254 = MULTITYPE_SENSOR

#### Device Classes

- 0 = ACTUATOR
- 1 = SENSOR
- 2 = STACK
- 3 = SLAVE
- 4 = MASTER
- 5 = BEACON
- 6 = CONTROLLER
- 14 = REMOTE_CONTROLLER (Gateway)
- 15 = UNKNOWN

### Priority

#### Priority Level

- 0 = Protection Level: Human
- 1 = Protection Level: Environment
- 2 = User Level 1
- 3 = User Level 2
- 4 = Comfort Level 1
- 5 = Comfort Level 2
- 6 = Comfort Level 3
- 7 = Comfort Level 4

#### Priority Level Lock

- 0 = No: No Priority Level Lock
- 1 = Min30: Lock one or more Priority Level for 30 Minutes
- 2 = Forever: Lock one or more Priority Level Forever

### Group Type

- 0 = User Group
- 1 = Room
- 2 = House

## Command IDs

### 00: Activate/Execute Function

- Command ID: 0x00 (1 byte)
- Command Originator (1 byte)
- ACEI (1 byte)
- Main parameter (2 bytes)
- Functional parameter 1 (1 byte)
- Functional parameter 2 (1 byte)

Example:
```
00 01 43 D2 00 00 00
```
Command ID=0, Originator=1 (User), ACEI=0x43, MainParam=0xD200 (Current), FP1=0, FP2=0

### 01: Activate Mode

- Command ID: 0x01 (1 byte)
- Command originator (1 byte)
- ACEI (1 byte)
- Mode number (1 byte)
- Mode parameter (1 byte)
- Unknown (1 byte)
- Unknown (1 byte)

### 03: Unknown

- Command ID: 0x03 (1 byte)
- Data? (3-6 bytes)

### 04: Unknown, answer to 03

- Command ID: 0x04 (1 byte)
- Data? (6-20 bytes)

### 0C: Unknown

- Command ID: 0x0c (1 byte)
- Data? (4 bytes)

### 20: Private protocol

- Command ID: 0x20 (1 byte)
- Manufacturer ID (1 byte)
- Data

Example:
```
20 02 ff0143000c0000
```
Command ID=0x20, Manufacturer=0x02 (SOMFY), Data=ff0143000c0000

### 21: Private Protocol Answer

- Command ID: 0x21 (1 byte)
- Manufacturer ID (1 byte)
- Data

### 28: Discover

- Command ID: 0x28 (1 byte)

**Note:** this frame can be sent without authentication

### 29: Discover Answer

- Command ID: 0x29 (1 byte)
- Node type and subtype (2 bytes): type on 10 bits and subtype on the remainer
  - Node type = (field >> 6) & 1023
  - Node subtype = field & 63
- Node address (3 bytes)
- Manufacturer ID (1 byte)
- Multi info byte (1 byte)
- Timestamp (2 bytes)

**Note:** this frame can be sent without authentication

Example:
```
29 ffc0 XXXXXX 0c cc 0000
```
Command ID = 0x29, node type = 1023 (REMOTE_CONTROLLER?), node subtype = 0, node address = XXXXXX, manufacturer = Atlantic, multi info byte = 0xcc, timestamp = 0

### 2A: Discover (Specialized)

- Command ID: 0x2a (1 byte)
- Challenge Key (12 bytes)

Example:
```HEX
D4 30 00003B 44457C 2A 01CCD93AE0EADA9AEDF98344 A862 # Velux Kux 100
```

**Note:** observed after launching the box in discover mode
**Note:** observed after launching the discover on a remote

### 2B: Discover (Specialized) Answer

- Parameters are similar to 0x29

- Command ID: 0x2b (1 byte)
- Node type and subtype (2 bytes)
  - Node type = (field >> 6) & 1023
  - Node subtype = field & 63
- Node address (3 bytes)
- Manufacturer ID (1 byte)
- Multi info byte (1 byte)
- Timestamp (2 bytes)

```
2b 0d01 XXXXXX 0c cc 0fb8
```
Command ID = 0x2b, node type = 52 (ELECTRICAL_HEATER), node subtype = 1, node address = XXXXXX, manufacturer = Atlantic, multi info byte = 0xcc, timestamp = 4024

### 2C: Discover Confirmation

- Command ID = 0x2c

No parameter. Some sort of discover ack?

**Note:** the frame does not require authentication

### 2D: Discover Confirmation Ack (Answer to 2C)

- Command ID = 0x2d

No parameter

**Note:** the frame does not require authentication

### 2E: Unknown

- Command ID: 0x2e (1 byte)
- ?? (1 byte), 00 (TaHoma sent) and 02 (Sauter heater) observed

**Note 1:** observed after launching the box in discover mode
**Note 2:** not authenticated?

Example:
```
2e 00
```

### 2F: Unknown, answer to 2e?

- Command ID: 0x2f (1 byte)
- ?? (1 byte), mirrors what is sent by 2e

Not authenticated?

### 30: Send 1W Key

- Command ID: 0x30 (1 byte)
- Encrypted key (16 bytes)
- Manufacturer ID (1 byte)
- ?? (1 byte)
- Sequence number (2 bytes)

Example:
```
30 7e60491f976adf653db0ed785e49a201 02 01 0c25
```
Command ID=0x30, key?: 7e60491f976adf653db0ed785e49a201, manufacturer ID=0x02, ??=0x01, Sequence number=0x0c25

### 31: Ask Challenge

- Command ID: 0x31 (1 byte)

No parameter. Destination device answers with 0x3c.

This command does not require authentication.

### 32: Key Transfer

- Command ID: 0x32 (1 byte)
- Encrypted 2-Way Key (16 bytes)

**Note:** the key is encrypted and depends of a challenge submitted before using 0x38 or 0x3c, see [LinkLayer](LinkLayer.md)

### 33: Key Transfer Ack

- Command ID: 0x33 (1 byte)

No parameter. Is sent after each 0x32 request.

### 36: Address Request

- Command ID: 0x36 (1 byte)

No parameter.

### 37: Address Answer (Answer to 36)

- Command ID: 0x37 (1 byte)
- Address (3 bytes)

### 38: Launch Key Transfer

- Command ID: 0x38 (1 byte)
- Challenge (6 bytes)

### 39: Remove 1W Controller

- Command ID: 0x39 (1 byte)
- ??: (1 byte): 0x00 observed

### 3C: Challenge Request

- Command ID: 0x3c (1 byte)
- Challenge data (6 bytes)

Example:
```
3c 4d3e778460f1
```
Command ID=0x3c, challenge=4d3e778460f1

### 3D: Challenge Response

- Command ID: 0x3d (1 byte)
- Response data (6 bytes)

Example:
```
3d 3ef8c09565f4
```
Command ID=0x3d, response=3ef8c09565f4

### 46: Unknown

- Command ID: 0x46 (1 byte)
- Data? (9 bytes)

### 47: Unknown (Answer to 46)

- Command ID: 0x47 (1 byte)
- Data (5 bytes)

### 48: Unknown

- Command ID: 0x48 (1 byte)
- Data? (9 bytes)

Not authenticated?

### 49: Unknown (Answer to 48)

- Command ID: 0x49 (1 byte)
- Data? (4 bytes)

Not authenticated?

### 4A: Large Data Transfer Request? ("ioblob")

- Command ID: 0x4a (1 byte)
- Data? (3-13 bytes)

### 4B: Large Data Answer?

- Command ID: 0x4b (1 byte)
- ?? (1 byte)
- Sequence number of data (1 byte)
- Data (1-18 bytes)

This command is chained to send large numbers of bytes. Maybe used for updates?

### 50: Get Name

- Command ID: 0x50 (1 byte)

No parameter. Not Authenticated.

### 51: Get Name Answer

- Command ID: 0x51 (1 byte)
- Name (16 bytes ASCII)

Not authenticated.

### 52: Write Name

- Command ID: 0x52 (1 byte)
- Data (16 bytes) ASCII

Example:
```
52 54657374000000000000000000000000
```
Command ID=0x52, Data="Test"

### 53: Write Name Ack

- Command ID: 0x53 (1 byte)

No parameter.

### 54: Get General Info 1

- Command ID: 0x54 (1 byte)

### 55: General Info 1 Answer

- Command ID: 0x55 (1 byte)
- Value (14 bytes)

Some parts of the value seem to be ASCII...

### 56: Get General Info 2

- Command ID: 0x56 (1 byte)

### 57: General Info 2 Answer

- Command ID: 0x57 (1 byte)
- Value (16 bytes)

### FE: Unknown

- Command ID: 0xfe (1 byte)
- ?? (1 byte)
